<%= form_with(model: holiday, class: "space-y-6") do |form| %>
  <% if holiday.errors.any? %>
    <div class="error-container">
      <h2 class="error-title"><%= pluralize(holiday.errors.count, "error") %> prohibited this holiday from being saved:</h2>
      <ul class="error-list">
        <% holiday.errors.each do |error| %>
          <li class="error-item"><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group">
    <%= form.label :name, "Name holiday *", class: "form-label" %>
    <div class="form-input-container">
      <%= form.text_field :name, class: "form-input", required: true, placeholder: "ชื่อวันหยุด" %>
      <div class="error-message" data-form-validation-target="nameError"></div>
    </div>
  </div>

  <div class="form-group">
    <%= form.label :date, "Date *", class: "form-label" %>
    <div class="form-input-container">
      <%= form.date_field :date, class: "form-input", required: true %>
      <div class="error-message" data-form-validation-target="dateError"></div>
    </div>
  </div>

  <div class="form-group">
    <%= form.label :is_bank_holiday, "Bank holiday" %>
    <%= form.check_box :is_bank_holiday %>
  </div>

  <div class="form-group">
    <%= form.label :is_exception, "Exception" %>
    <%= form.check_box :is_exception %>
    <small class="form-text text-muted">Select if you want this day to be a working day even if it is a holiday</small>
  </div>

  <div class="form-group">
    <%= form.label :description, "Description" %>
    <%= form.text_area :description, class: "form-control" %>
  </div>

  <div class="form-actions">
    <%= form.submit class: "submit-button", data: { disable_with: "Saving..." } %>
    <%= link_to "Cancel", holidays_path, class: "cancel-button" %>
  </div>
<% end %>

<%= javascript_tag do %>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const nameInput = form.querySelector('#holiday_name');
    const dateInput = form.querySelector('#holiday_date');

    function showError(input, message) {
      const errorDiv = document.getElementById(`${input.id.split('_').pop()}_error`);
      errorDiv.textContent = message;
      errorDiv.classList.remove('hidden');
      input.classList.add('border-red-500');
    }

    function hideError(input) {
      const errorDiv = document.getElementById(`${input.id.split('_').pop()}_error`);
      errorDiv.classList.add('hidden');
      input.classList.remove('border-red-500');
    }

    nameInput.addEventListener('blur', function() {
      if (!this.value) {
        showError(this, 'กรุณากรอกชื่อวันหยุด');
      } else {
        hideError(this);
      }
    });

    dateInput.addEventListener('blur', function() {
      if (!this.value) {
        showError(this, 'กรุณาเลือกวันที่');
      } else {
        hideError(this);
      }
    });

    form.addEventListener('submit', function(e) {
      let isValid = true;

      if (!nameInput.value) {
        showError(nameInput, 'กรุณากรอกชื่อวันหยุด');
        isValid = false;
      }

      if (!dateInput.value) {
        showError(dateInput, 'กรุณาเลือกวันที่');
        isValid = false;
      }

      if (!isValid) {
        e.preventDefault();
      }
    });
  });
<% end %> 